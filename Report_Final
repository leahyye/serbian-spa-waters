---
title: "Serbian Spa Waters Report"
author: "Leah Ye 300651931, Harry Philpott 300667756, Claude Butler 300651409,
Elizabeth Myers 300641471"
output: bookdown::pdf_document2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(knitr)
library(GGally)
library(ggplot2)
library(tidyr)
library(corrplot)
library(kableExtra)
```

# **Introduction**

This study analyzed hydrochemical data for mineral and thermal waters in 
Serbian territory. The authors used principal component analysis (PCA) and 
hierarchical cluster analysis (HCA) to characterize the chemical composition 
and natural radioactivity of these water samples, understand the relationships 
between the variables measured, and classify the waters with respect to their 
geotectonic units. PCA revealed four latent factors that accounted for 74.2% of 
the variability among the observations. Two of these four PCs are based on 
measures of mineralisation of the components of the host rock, and the other 
two are based on variables that are indicative of natural radioactivity. The 
results of HCA achieved a total correct classification of 83.3% for predefined 
geotectonic units, and the dendrogram produced classified the samples into four 
major groups and eleven subgroups.

# **Methodology**

The Serbian Spa Waters Dataset contains 30 observations(sites), with 15 columns:

-   idNum: Integer - Index of each observation;\
-   waterSource: Character - Spa/Spring the observation belongs to;\
-   tempCels: Numerical - Outflowing temperature (Â°C);
-   pH: Numerical - pH level(Acidity/Alkalinity);\
-   elecCond: Integer - Electrical Conductivity of water measured immediately 
    after collection on the spot, total ion concentration ($\mu$S/cm);\
-   totSolid: Numerical - Total dissolved solids (gL)
-   Ca2: Numerical - Calcium (mg/L);\
-   Mg2: Numerical - Magnesium (mg/L);\
-   Na: Numerical - Sodium (mg/L);\
-   K: Numerical - Potassium (mg/L);\
-   Cl: Numerical - Chlorine (mg/L);\
-   S02: Numerical - Sulfate (mg/L);\
-   HCO: Numerical - Bicarbonate (mg/L);\
-   Si0: Numerical - Silica, dissolved silicon dioxide (mg/L);\
-   geoStruct: Integer - The geological structure the water was collected from 
    (1 = Hydrological Basin, 2 = Karstic terrains, 3 = Volcanogen Massifs, 
     4 = Metamorphic Regions)

Ions $\mathrm{(HCO_3^-, Ca^{2+}, Mg^{2+}, Na^+, K^+, Cl^-, SO_4^{2-}, SiO_2)}$ 
were analysed in the laboratories of the Institute of Public Health of Serbia. 
Titration methods were applied to measure alkalinity of $Ca^{2+}$ and $Mg^{2+}$. 
Concentrations of $Na^+$ and $K^+$ were determined by atomic absorption 
spectrophotometry.

Where Hyodrological Basins and Karstic terrains have 5 observations each, 
Volcanogen Massifs has 14 observations, and Metamorphic Regions has 6 
observations. This is an unbalanced dataset since there are varying observations 
per group.

There are no duplicates, missing data, zeros, negatives, NAs or NULL values in 
the dataset.

Exploratory data analysis will assess basic summary statistics of the data.
We will utilise graphical analysis of a pairs plots, box plots, and QQ plot to 
check basic assumptions of  required for further analysis, such as both
univariate and multivariate normality. A correlation plot and Principal 
Component Analysis (PCA) will be performed to further investigate the 
relationships between variables. We will also identify outliers and 
surprising observations within the data, using standard deviation as well as
Mahalanobis distance, and in terms of the principal components.

Our initial exploratory data analysis revealed that the dataset was 
characterised by high variability and right-skewedness, leading us to perform
a log transformation on the data and use these transformed variables for our
further analysis.

We will assess the validity of the paper's geoStruct groups based on the data,
using the methods of MANOVA and Naive Bayes Classifier, as our EDA revealed
that the data violates the assumptions for Linear Discriminant Analysis.

We will then use Factor Analysis to attempt to improve on the paper's model 
parsimony; factor analysis is better for model selection since it doesn't 
include noise like PCA, and maintains parsimony. 

# **Results**

```{r echo=FALSE}
data <- read.csv("serbianspawater.csv")
```

```{r echo=FALSE}
# Select numeric columns
numeric_cols <- data[sapply(data, is.numeric) & !(names(data) %in% c("idNum", "geoStruct"))]

# Create summary table
summary <- data.frame(
  Variable = names(numeric_cols),
  Mean     = round(sapply(numeric_cols, mean), 2),
  Median   = round(sapply(numeric_cols, median), 2),
  SD       = round(sapply(numeric_cols, sd), 2),
  Min      = round(sapply(numeric_cols, min), 2),
  Max      = round(sapply(numeric_cols, max), 2),
  row.names = NULL
)

# Format summary to show two decimal places
summary_formatted <- summary
summary_formatted[, 2:6] <- lapply(summary[, 2:6], function(x) sprintf("%.2f", x))

# Display table
kable(summary_formatted, caption = "Summary Statistics for Numeric Columns", align = c("l", "r", "r", "r", "r", "r")) %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, extra_css = "font-family: serif;") %>%  
  column_spec(1:ncol(summary), extra_css = "font-family: serif;")  
```
This dataset is characterized by high variability. This is likely due to the 
different water sources. pH is more consistent, ranging from neutral (6.5) to 
slightly basic (9.0), which are fairly typical values for water in nature. The 
range of temperatures recorded in this dataset is from 14.40 to 95.00 degrees 
celcius. The large standard deviation confirms that there is a lot of 
variability in temperature. Some of these water sources are near boiling 
temperatures. Electrical conductivity also has a very large range, from 110.00 
to 5100.00 $\mu$S/cm. This indicates that some water samples have a lot of 
dissolved ions, leading to high conductivity. This measure is roughly 
proportional to the total dissolved solids, which also displays a large range, 
from 0.10 to 6.20. The maximum is more than three standard deviations above the 
mean, suggesting right-skew and surprising observations. There are eight major 
ions in this dataset: Calcium ($\mathrm{Ca^{2+}}$), 
Magnesium ($\mathrm{Mg^{2+}}$), Sodium ($\mathrm{Na^+}$), 
Potassium ($\mathrm{K^+}$), Chloride ($\mathrm{Cl^-}$), 
Sulfate ($\mathrm{SO_4^{2-}}$), Bicarbonate ($\mathrm{HCO_3^-}$), and 
Silica ($\mathrm{SiO_2}$). All of them are characterized by high variability, 
often with right-skew. Calcium has a mean of 61.02 and a range of 4.00 to 
178.00. The maximum is three standard deviations above the mean. Magnesium has 
an average of 44.46 and a range of 0.10 to 293.00, with a maximum that is four 
standard deviations above the mean. Sodium has a high average of 447.09, and a 
high maximum of 2280.00, which is again three standard deviations above the 
mean. Potassium is not as elevated with a mean of 16.58, but it is still 
somewhat variable. Chloride has a particularly extreme maximum of 1560.00, 
which is five standard deviations above its mean of 108.70. Sulfate has a mean 
of 57.53 and a maximum of 486.00, which is four standard deviations above the 
mean. Bicarbonate has a very high mean of 1297.91, and the maximum reaches a 
staggering 3538.00. The last major ion is Silica, which has a mean of 38.73, but 
a range from 2.00 to 120.00. To summarize, the whole dataset show high 
variability and pervasive right-skewness. The chemical composition of the water
samples is largely dominated by bicarbonate, with sodium and chloride also 
reaching very high values for some samples.

```{r boxplots, echo=FALSE, include=TRUE, warning=FALSE, message=FALSE, fig.asp=0.8}
# Select numeric features for scaling 
X <- data[, 3:14]                    #all numerical catergories
X <- as.data.frame(scale(X))         # z-scores per variable
X$.row <- 1:nrow(X)

# reshaping is to long for ggplot so use tidyr library
box_long <- pivot_longer(           #tidyr
  X,
  cols = - .row,
  names_to = "variable",
  values_to = "value"
)

# boxplots on a common axis (z-scored)
ggplot(box_long, aes(x = variable, y = value)) +
  geom_boxplot(notch = TRUE, outlier.alpha = 0.6, na.rm = TRUE) +
  coord_flip() +
  labs(x = NULL, y = "Scaled value (z-score)",
       title = "Fig. 1: Serbian Spa Water: boxplots of all variables (z-scored)") +
  theme(panel.grid.minor = element_blank())
```
Variables were standardised to z-scores to allow direct comparison despite 
differing measurement units. The boxplots (Fig. 1) show that some features 
(e.g. $\mathrm{Na^+}$, $\mathrm{Cl^-}$, $\mathrm{HCO_3^-}$) have greater 
variability and distinct outliers, while others remain tightly clustered around 
the mean. This highlights which chemical measures are most heterogeneous across 
the spa waters. However, all variables in the boxplot have a non-symmetrical 
shape and contain outliers, indicating that a log transformation is necessary.
